var mailbox={idx:0,action:0,account_id:[0,0,0,0,0,0,0,0],account_name:""},base=623056584704;function call_native(){write_ptr_at(base+16,mailbox.idx),write_ptr_at(base+24,mailbox.action),write_mem(base+32,mailbox.account_id);for(var a=unescape(encodeURIComponent(mailbox.account_name)).substring(0,16),b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c));b.push(0),write_mem(base+40,b),pivot(base),mailbox.idx=read_ptr_at(base+16),mailbox.action=read_ptr_at(base+24),mailbox.account_id=read_mem(base+32,8),b=read_mem(base+40,17),a="";for(var c=0;b[c];c++)a+=String.fromCharCode(b[c]);mailbox.account_name=decodeURIComponent(escape(a))}function makeUI(){var a=document.createElement("div");a.style.position="absolute",a.style.top=a.style.left=0,a.style.width=a.style.height="100%",a.style.zIndex=1e3,a.style.background="white";var b=document.createElement("p");a.appendChild(b);var c=document.createElement("i");b.appendChild(c),c.appendChild(document.createTextNode("Click the username to generate a random ID"));var d=document.createElement("table");a.appendChild(d);var e=document.createElement("tr");d.appendChild(e);var f=document.createElement("th");f.setAttribute("colspan",2),e.appendChild(f);var g=document.createElement("th");e.appendChild(g),g.appendChild(document.createTextNode("Base64 ID (for Chiaki)"));var h=document.createElement("th");e.appendChild(h);for(var e,j=[],k=0;16>k;k++){e=document.createElement("tr"),d.appendChild(e);var l=document.createElement("td");l.style.position="relative",e.appendChild(l);var m=document.createElement("span");l.append(m);var n=document.createElement("button");n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.opacity="0",l.append(n);var o=document.createElement("td");e.appendChild(o);var p=document.createElement("input");o.appendChild(p);var g=document.createElement("td");e.appendChild(g);var q=document.createElement("input");q.readOnly=!0,q.disabled=!0,g.appendChild(q);var h=document.createElement("td");e.appendChild(h);var r=document.createElement("button");h.appendChild(r),r.appendChild(document.createTextNode("Set & Activate")),j.push({username:m,username_btn:n,id:p,base64:q,button:r})}return document.body.appendChild(a),j}var ui=makeUI();function setRandomID(a){for(var b="",c=0;16>c;c++)b+="0123456789ABCDEF"[0|16*Math.random()];return ui[a].id.value=b,!1}function fetchAccount(a){for(mailbox.idx=a,mailbox.action=0,call_native();ui[a].username.firstChild;)ui[a].username.removeChild(ui[a].username.firstChild);if(!mailbox.account_name){var b=document.createElement("i");return ui[a].username.appendChild(b),b.appendChild(document.createTextNode("Account does not exist")),ui[a].id.value="",ui[a].id.readOnly=!0,ui[a].base64.value="",void(ui[a].button.disabled=!0)}for(var c,d="",e=7;0<=e;e--)c=mailbox.account_id[e],d+="0123456789ABCDEF"[c>>4],d+="0123456789ABCDEF"[15&c];for(var f="",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0;8>e;e+=3)f+=g[mailbox.account_id[e]>>2],f+=g[63&(mailbox.account_id[e]<<4|mailbox.account_id[e+1]>>4)],f+=g[63&(mailbox.account_id[e+1]<<2|mailbox.account_id[e+2]>>6)],f+=g[63&mailbox.account_id[e+2]];f=f.substr(0,11)+"=",ui[a].username.appendChild(document.createTextNode(mailbox.account_name)),ui[a].id.value=d,ui[a].id.readOnly=!1,ui[a].base64.value=f,ui[a].button.disabled=!1}function fetchAccounts(){for(var a=0;16>a;a++)fetchAccount(a)}function activateAccount(a){mailbox.idx=a;var b=ui[a].id.value;16!=b.length&&(b="XXXXXXXXXXXXXXXX");for(var c,d=[],e=7;0<=e;e--){if(c=16*parseInt(b[2*e],16)+parseInt(b[2*e+1],16),c!=c)return void alert("Must be 16 characters long and only contain [0-9A-F]");d.push(c)}return mailbox.action=1,mailbox.account_id=d,call_native(),fetchAccounts(),ui[a].id.value==b.toUpperCase()&&alert("PSN ID set successfully!"),!1}fetchAccounts();for(var i=0;16>i;i++)ui[i].username_btn.onclick=setRandomID.bind(window,i),ui[i].button.onclick=activateAccount.bind(window,i);